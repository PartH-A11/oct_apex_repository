        stage('Update and Push to Test Branch') {
            steps {
                script {
                    def originalFile = "App_Code/f987456321.sql"

                    // Revert changes after deployment
                    sh "sed -i 's/2987456321/987456321/g' ${originalFile}"
                    sh "sed -i 's/SUN_22001_TEST/SUN_22001_DEV/g' ${originalFile}"
                    sh "sed -i 's/sun_22001_test/sun_22001_dev/g' ${originalFile}"
                    sh "sed -i 's/1096018791012195213/1088565718848511844/g' ${originalFile}"

                    // Generate versioned filename
                    def version = new Date().format("yyyyMMdd_HHmmss")
                    def versionedFile = "App_Code/f987456321_v${version}.sql"
                    sh "cp ${originalFile} ${versionedFile}"

                    // Use Git credentials for push
                    withCredentials([usernamePassword(credentialsId: 'GITHUB_CREDS', usernameVariable: 'GIT_USER', passwordVariable: 'GIT_TOKEN')]) {
                        // Set Git config
                        sh 'git config user.name "PartH-A11"'
                        sh 'git config user.email "parth.suthar@octalsoft.com"'

                        // Switch to test branch
                        sh 'git checkout test'

                        // Set remote with credentials embedded
                        sh 'git remote set-url origin https://${GIT_USER}:${GIT_TOKEN}@github.com/PartH-A11/oct_apex_repository.git'

                        // Commit and push
                        sh "git add ${versionedFile}"
                        sh "git commit -m 'Added versioned SQL: ${versionedFile}' || echo 'No changes to commit'"
                        sh 'git push origin test'
                    }
                }
            }
        }
